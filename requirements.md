# fließend - 要件定義書

**Version:** 0.1.0
**Last Updated:** 2025-11-01
**Status:** Draft

---

## 1. プロジェクト概要

### 1.1 プロジェクト名
**fließend**（フリーセンド）

### 1.2 目的
フォルダ構造をアウトライナーのように編集できるツールを開発し、思考の整理とファイルシステムの整理を統合する。

### 1.3 コアコンセプト
```
アウトライナーを編集していたら、
そのままフォルダ構造が整理されている
```

---

## 2. システム要件

### 2.1 対象プラットフォーム

#### MVP版
- **プラットフォーム:** macOS（優先）
- **最小バージョン:** macOS 10.15 (Catalina) 以降
- **開発環境:** macOS

#### 将来対応
- Windows 10/11
- Linux (Ubuntu, Fedora等)

### 2.2 ハードウェア要件

| 項目 | 最小要件 | 推奨要件 |
|------|----------|----------|
| CPU | Intel Core i3 以上 | Intel Core i5 以上 / M1以降 |
| RAM | 4GB | 8GB以上 |
| ディスク容量 | 200MB（Electron版） | 500MB以上 |
| ディスプレイ | 1280×720 | 1920×1080以上 |

---

## 3. 機能要件

### 3.1 MVP（Minimum Viable Product）必須機能

| ID | 機能名 | 説明 | 優先度 | 見積時間 |
|----|--------|------|--------|----------|
| FR-001 | フォルダ選択 | ルートフォルダを選択して読み込む | P0 | 2-3h |
| FR-002 | ツリー表示 | フォルダ/ファイルを階層的に表示 | P0 | 3-5h |
| FR-003 | ノード追加 | 新規フォルダ/ファイルを作成 | P0 | 3-4h |
| FR-004 | ノード削除 | ファイル/フォルダを削除 | P0 | 2-3h |
| FR-005 | ノード名変更 | アウトライン上でリネーム | P0 | 2-3h |
| FR-006 | 階層変更（Tab） | Tabキーでインデントを下げる（親フォルダに移動） | P0 | 4-5h |
| FR-007 | 階層変更（Shift+Tab） | Shift+Tabでインデントを上げる | P0 | 4-5h |
| FR-008 | 双方向同期 | UI変更→FS、FS変更→UIの即座の反映 | P0 | 8-12h |
| FR-009 | キーボードナビゲーション | ↑↓キーでアイテム選択移動 | P0 | 2-3h |
| FR-010 | フォルダ開閉 | フォルダの展開/折りたたみ | P0 | 3-4h |

**総見積もり:** 40-60時間（1-2週間）

### 3.2 UI/UX要件

#### 3.2.1 ビジュアル要件
- **バレット表示:** すべてのノードに `・` を表示
- **ホバー時インジケーター:**
  - フォルダにマウスホバー時のみ表示
  - `>` : 閉じている（子要素が隠れている）
  - `∨` : 開いている（子要素が見えている）
- **インデント:** 階層に応じて視覚的にインデント表示

#### 3.2.2 キーボードショートカット（MVP）

| キー | 動作 | 優先度 |
|------|------|--------|
| `Tab` | ノードを一段階下げる | P0 |
| `Shift+Tab` | ノードを一段階上げる | P0 |
| `↑/↓` | ノード選択移動 | P0 |
| `Enter` | ノード名編集 | P0 |
| `Cmd+N` | 新規ノード | P1 |
| `Delete` | ノード削除 | P1 |
| `Space` | フォルダ展開/折りたたみ | P1 |

### 3.3 将来実装予定機能（Phase 2以降）

| ID | 機能名 | 説明 | 優先度 |
|----|--------|------|--------|
| FR-101 | Markdown展開 | Markdownファイルの内容を展開表示 | P1 |
| FR-102 | メタデータ | .outline-meta/でノート・タグを保存 | P2 |
| FR-103 | 重複名許容 | 内部でUUID管理、表示名と実際のフォルダ名を分離 | P2 |
| FR-104 | 画像プレビュー | 画像ファイルのサムネイル表示 | P2 |
| FR-105 | 検索機能 | フォルダ/ファイル名の検索 | P2 |
| FR-106 | ドラッグ&ドロップ | マウスでノードを移動 | P2 |
| FR-107 | 複数選択 | 複数ノードを同時に操作 | P3 |
| FR-108 | AI統合 | Claudeと対話しながらフォルダを整理 | P3 |
| FR-109 | ターミナル統合 | Ctrl+Tでターミナルを開く | P3 |

---

## 4. 非機能要件

### 4.1 パフォーマンス要件

| ID | 項目 | 目標値 | 測定方法 |
|----|------|--------|----------|
| NFR-001 | 初回ロード時間 | 100ファイル以下：1秒以内 | 手動測定 |
| NFR-002 | ノード操作レスポンス | UI操作→画面更新：100ms以内 | 手動測定 |
| NFR-003 | ファイルシステム反映 | UI操作→FS変更：500ms以内 | 手動測定 |
| NFR-004 | 最大ファイル数（MVP） | 1,000ファイルまで動作保証 | テスト環境で確認 |

### 4.2 信頼性要件

| ID | 項目 | 要件 |
|----|------|------|
| NFR-101 | データ損失防止 | ファイル移動失敗時、元の状態を保持 |
| NFR-102 | エラーハンドリング | 権限エラー、衝突、移動不可を適切に通知 |
| NFR-103 | 操作の可逆性 | エラー時のロールバック機能（最低限） |

### 4.3 ユーザビリティ要件

| ID | 項目 | 要件 |
|----|------|------|
| NFR-201 | 学習時間 | 基本操作を5分以内に習得可能 |
| NFR-202 | 視覚的フィードバック | すべての操作に即座のフィードバック |
| NFR-203 | エラーメッセージ | ユーザーが理解できる言語で表示 |
| NFR-204 | ミニマルデザイン | 視覚的ノイズを最小限に |

### 4.4 保守性要件

| ID | 項目 | 要件 |
|----|------|------|
| NFR-301 | コードの可読性 | コメント、命名規則の遵守 |
| NFR-302 | モジュール化 | 機能ごとに分離された構造 |
| NFR-303 | ドキュメント | README、仕様書、APIドキュメント |

---

## 5. 技術要件

### 5.1 技術スタック（MVP版）

| レイヤー | 技術 | バージョン | 理由 |
|----------|------|------------|------|
| フレームワーク | Electron | 最新安定版 | クロスプラットフォーム、開発速度 |
| UI | HTML + CSS + JavaScript | ES6+ | シンプル、軽量（まずはプレーンJS） |
| ファイル操作 | Node.js `fs` | Node.js 16+ | 標準ライブラリ |
| ファイル監視 | chokidar | 最新版 | 双方向同期のため |
| ビルド | electron-builder | 最新版 | アプリケーションパッケージング |

### 5.2 アーキテクチャ（Electron版）

```
┌─────────────────────────────────┐
│    Renderer Process (UI)        │
│  - HTML + CSS + JavaScript      │
│  - Outline Tree Component       │
│  - File System Viewer           │
└─────────────┬───────────────────┘
              │ IPC
┌─────────────▼───────────────────┐
│    Main Process (Node.js)       │
│  - File System API (fs)         │
│  - File Watcher (chokidar)      │
│  - CRUD Operations              │
└─────────────┬───────────────────┘
              │
┌─────────────▼───────────────────┐
│    Local File System            │
│  - Folders & Files              │
│  - .outline-meta/ (Phase 2)     │
└─────────────────────────────────┘
```

### 5.3 データモデル

#### ノード構造（MVP）
```javascript
{
  "id": "unique-id",           // 内部識別子
  "name": "フォルダ名",         // 表示名
  "path": "/absolute/path",    // 絶対パス
  "type": "folder|file",       // タイプ
  "children": [],              // 子ノード（フォルダのみ）
  "isExpanded": true,          // 展開状態
  "parent": "parent-id"        // 親ノードID
}
```

#### メタデータ構造（Phase 2）
```json
{
  "id": "abc123",
  "displayName": "プロジェクト資料",
  "realPath": "project_docs",
  "note": "企画書と仕様書",
  "tags": ["#企画", "#2025"],
  "created": "2025-11-01T10:00:00Z",
  "updated": "2025-11-01T15:30:00Z"
}
```

### 5.4 双方向同期の実装

#### 監視対象
- フォルダ/ファイルの作成
- フォルダ/ファイルの削除
- フォルダ/ファイルの移動
- フォルダ/ファイルの名前変更

#### 衝突解決ポリシー
- 最終更新日時で判定
- ユーザーに選択肢を提示（上書き/キャンセル）

---

## 6. 開発環境

### 6.1 必要なソフトウェア

| ソフトウェア | バージョン | 用途 |
|--------------|------------|------|
| Node.js | 16.x 以降 | 実行環境 |
| npm | 8.x 以降 | パッケージ管理 |
| Electron | 最新安定版 | アプリケーションフレームワーク |
| Git | 2.x 以降 | バージョン管理 |

### 6.2 開発ツール

- **エディター:** VS Code（推奨）
- **デバッガー:** Electron DevTools
- **Hot Reload:** electron-reload

---

## 7. 制約事項

### 7.1 技術的制約

| ID | 制約 | 理由 |
|----|------|------|
| CON-001 | Electron使用によるアプリサイズ増加（100MB+） | クロスプラットフォーム対応のトレードオフ |
| CON-002 | 大量ファイル（10,000+）での性能低下の可能性 | MVP版ではパフォーマンス最適化は未実施 |
| CON-003 | シンボリックリンクの扱いは未定義 | Phase 2で検討 |

### 7.2 機能的制約

| ID | 制約 | 理由 |
|----|------|------|
| CON-101 | MVP版ではメタデータ機能なし | 開発時間の制約 |
| CON-102 | Undo/Redo機能は最低限（エラー時のみ） | 開発時間の制約 |
| CON-103 | クラウド同期機能なし | MVP版の範囲外 |

### 7.3 運用上の制約

| ID | 制約 | 理由 |
|----|------|------|
| CON-201 | システムフォルダ（/System, /Applications等）の編集は非推奨 | 安全性確保 |
| CON-202 | 権限のないフォルダへのアクセスはエラー | OSレベルの制約 |

---

## 8. テスト要件

### 8.1 テスト範囲

| テストタイプ | 範囲 | 優先度 |
|--------------|------|--------|
| 手動テスト | すべての基本機能 | P0 |
| パフォーマンステスト | 100, 500, 1000ファイルでの動作確認 | P1 |
| エラーハンドリングテスト | 権限エラー、衝突、移動不可ケース | P0 |
| UI/UXテスト | キーボードショートカット、視覚的フィードバック | P1 |

### 8.2 テストケース例

#### TC-001: Tab操作による階層変更
- **前提:** ツリーにフォルダA、フォルダB（Aの次）が存在
- **操作:** フォルダBを選択してTabキーを押下
- **期待結果:** フォルダBがフォルダAの子になる

#### TC-002: ファイルシステム同期
- **前提:** アプリで特定フォルダを監視中
- **操作:** 外部エディタでファイルを作成
- **期待結果:** アプリのツリーに新規ファイルが表示される

---

## 9. 開発スケジュール

### Phase 0: プロトタイプ（目標：2週間）

| フェーズ | タスク | 見積時間 | 状態 |
|----------|--------|----------|------|
| 環境セットアップ | Electronプロジェクト初期化、開発環境整備 | 4-6h | 未着手 |
| 基本表示機能 | フォルダ選択、ツリー読み込み・表示 | 8-12h | 未着手 |
| インタラクション | ホバー、開閉、ナビゲーション | 12-16h | 未着手 |
| コア機能 | Tab/Shift+Tab階層変更 | 12-16h | 未着手 |
| FS反映 | ファイル移動実装、エラーハンドリング | 8-12h | 未着手 |
| UI/UX洗練 | スタイリング、フィードバック | 4-6h | 未着手 |
| テスト・仕上げ | 手動テスト、README更新 | 4-6h | 未着手 |

**総見積もり:** 40-60時間

### Phase 1: MVP（目標：1-2ヶ月）
- 双方向同期の強化
- Markdown展開機能
- 基本的なエラーハンドリング

### Phase 2: β版（目標：3-4ヶ月）
- メタデータ機能
- UI/UXの洗練
- パフォーマンス最適化

---

## 10. 成功基準

### 10.1 MVP版の成功基準

| 基準 | 測定方法 |
|------|----------|
| Tab/Shift+Tabでフォルダ階層を変更できる | 手動テストで確認 |
| ファイルシステムに即座に反映される | 手動テストで確認 |
| 100ファイル程度で快適に動作する | パフォーマンステスト |
| エラー発生時にデータが失われない | エラーハンドリングテスト |
| 5分以内に基本操作を習得できる | ユーザビリティテスト |

---

## 11. リスク管理

### 11.1 技術リスク

| リスク | 影響度 | 対策 |
|--------|--------|------|
| ファイル移動操作の失敗 | 高 | エラーハンドリング、ロールバック機能 |
| 大量ファイルでのパフォーマンス問題 | 中 | 仮想スクロール、遅延読み込み（Phase 2） |
| 双方向同期の競合 | 中 | 最終更新日時で判定、ユーザー確認 |

### 11.2 スケジュールリスク

| リスク | 影響度 | 対策 |
|--------|--------|------|
| 見積もりオーバー | 中 | 優先度の低い機能を Phase 2 に延期 |
| 技術的問題による遅延 | 中 | シンプルな実装を優先、複雑な機能は延期 |

---

## 12. 参考資料

### 12.1 プロジェクト内ドキュメント
- `README.md` - プロジェクト概要
- `Specification.md` - 詳細仕様書
- `TODO.md` - 開発タスク一覧

### 12.2 外部リンク
- [Electron Documentation](https://www.electronjs.org/)
- [chokidar (File Watcher)](https://github.com/paulmillr/chokidar)
- [Node.js fs API](https://nodejs.org/api/fs.html)

---

## 13. 承認

| 役割 | 氏名 | 承認日 | 署名 |
|------|------|--------|------|
| プロジェクトオーナー | - | - | - |
| 技術リード | - | - | - |

---

**Document Status:** Draft
**Next Review Date:** 2025-11-08
**Version History:**
- v0.1.0 (2025-11-01): 初版作成
